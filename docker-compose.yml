services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cdattg-gibse-web
    restart: unless-stopped
    environment:
      - APACHE_DOCUMENT_ROOT=/var/www/html
    networks:
      - cdattg-gibse-network
    # Perfil de desarrollo: puerto 8080 y volúmenes para hot-reload
    profiles:
      - dev
    ports:
      - "8080:80"
    volumes:
      - .:/var/www/html

  web-prod:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cdattg-gibse-web
    restart: unless-stopped
    environment:
      - APACHE_DOCUMENT_ROOT=/var/www/html
    networks:
      - cdattg-gibse-network
    # Perfil de producción: solo localhost, sin volúmenes (excepto logs)
    profiles:
      - prod
    ports:
      - "127.0.0.1:8081:80" # Puerto interno 8081 para evitar conflicto con Nginx en 80
    volumes:
      # Solo montar logs para que persistan en el host
      - ./logs:/var/www/html/logs

networks:
  cdattg-gibse-network:
    driver: bridge
